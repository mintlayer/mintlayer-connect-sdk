<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mintlayer Wallet Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: linear-gradient(to bottom right, #f0f9ff, #e0f2fe);
        min-height: 100vh;
      }
    </style>
</head>
<body class="font-sans text-gray-800 antialiased">
<div class="container mx-auto max-w-5xl p-6 flex flex-col lg:flex-row gap-6">
    <!-- Left Column: Actions -->
    <div class="lg:w-1/2 space-y-6">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Mintlayer Wallet Demo</h1>

        <div class="flex justify-center mb-4">
            <div class="flex items-center space-x-2">
                <label for="network" class="text-sm font-medium text-gray-700">Select Network:</label>
                <select id="network" onchange="changeNetwork()" class="border border-gray-300 rounded-md p-2 bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="mainnet">Mainnet</option>
                    <option value="testnet">Testnet</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="checkConnection()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Check Connection</button>
            <button onclick="connectWallet()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Connect Wallet</button>
            <button onclick="getNewAddress()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get New Address</button>
            <button onclick="getVersion()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Version</button>
            <button onclick="createDelegation()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Create Delegation</button>
            <button onclick="getBalance()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Balance</button>
            <button onclick="getDelegations()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Delegations</button>
            <button onclick="getDelegationsTotal()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Delegations Total</button>
        </div>

        <div class="space-y-4">
            <!-- Toggle Buttons -->
            <div class="flex justify-between">
                <button onclick="toggleSection('transfer')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Transfer</button>
                <button onclick="toggleSection('signTx')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Sign Transaction</button>
                <button onclick="toggleSection('issueToken')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Issue Token</button>
            </div>

            <!-- Transfer Section -->
            <div id="transfer" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Transfer</h3>
                <div class="space-y-4">
                    <input type="text" id="send_to" placeholder="Recipient Address" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="amount" placeholder="Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="doTransfer()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Sign Transaction Section -->
            <div id="signTx" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Sign Transaction</h3>
                <div class="space-y-4">
                    <textarea id="transactionData" rows="5" placeholder="Complete Transaction Data" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"></textarea>
                    <button onclick="signTransaction()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Issue Token Section -->
            <div id="issueToken" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Issue Token</h3>
                <div class="space-y-4">
                    <input type="text" id="authority" placeholder="Authority Address" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="issueToken()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Output -->
    <div class="lg:w-1/2">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Output</h3>
        <div id="output" class="bg-white p-4 rounded-lg shadow-md text-sm text-gray-600 whitespace-pre-wrap h-96 overflow-y-auto border border-gray-200"></div>
    </div>
</div>

<script src="../src/mintlayer-wasm-lib/release/wasm_wrappers.js"></script>
<script src="../src/mintlayer-connect-sdk.js"></script>
<script>
  function changeNetwork() {
    const network = document.getElementById('network').value;
    window.mintlayer.setNetwork(network);
    displayOutput(`Network changed to: ${network}`);
  }

  function toggleSection(sectionId) {
    const sections = ['transfer', 'signTx', 'issueToken'];
    sections.forEach(id => {
      const el = document.getElementById(id);
      if (id === sectionId) {
        el.classList.toggle('hidden');
      } else {
        el.classList.add('hidden');
      }
    });
  }

  function displayOutput(message) {
    const output = document.getElementById('output');
    output.textContent = `${new Date().toLocaleTimeString()} - ${message}\n${output.textContent}`;
  }

  async function checkConnection() {
    try {
      const result = await window.mintlayer.request({ method: 'checkConnection' });
      displayOutput(`Connection status: ${JSON.stringify(result, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function connectWallet() {
    try {
      const addresses = await window.mintlayer.connect();
      displayOutput(`Connected: ${JSON.stringify(addresses, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getNewAddress() {
    try {
      const addresses = await window.mintlayer.request({ method: 'getNewAddress' });
      displayOutput(`New address: ${JSON.stringify(addresses, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getVersion() {
    try {
      const version = await window.mintlayer.request({ method: 'version' });
      displayOutput(`Version: ${JSON.stringify(version, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getBalance() {
    try {
      const balance = await window.mintlayer.getBalance();
      displayOutput(`Balance: ${JSON.stringify(balance, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getDelegations() {
    try {
      const delegations = await window.mintlayer.getDelegations();
      displayOutput(`Delegations: ${JSON.stringify(delegations, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getDelegationsTotal() {
    try {
      const delegations = await window.mintlayer.getDelegationsTotal();
      displayOutput(`Delegations Total: ${JSON.stringify(delegations, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function createDelegation() {
    try {
      const delegateResult = await window.mintlayer.request({
        method: 'delegate',
        params: { poolId: 'tpool106xgru3kyxzuhhsx666gvktd5y34ucke2wkkwqzysc29jk0ul82qzj4tzh' }
      });
      displayOutput(`Delegate: ${JSON.stringify(delegateResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function doTransfer() {
    const to = document.getElementById('send_to').value;
    const amount = document.getElementById('amount').value;

    if (!to || !amount) {
      displayOutput('Please provide both recipient address and amount.');
      return;
    }

    try {
      const transferResult = await window.mintlayer.transfer({ to, amount });
      displayOutput(`Transfer result: ${JSON.stringify(transferResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function issueToken() {
    const authority = document.getElementById('authority').value;

    if (!authority) {
      displayOutput('Please provide authority.');
      return;
    }

    try {
      const tokenData = {
        is_freezable: false,
        metadata_uri: {
          hex: "68747470733a2f2f6578616d706c652e636f6d2f646174612e6a736f6e",
          string: "https://example.com/data.json"
        },
        number_of_decimals: 8,
        token_ticker: { hex: "4c4c4c", string: "LLL" },
        total_supply: { type: "Unlimited" },
        type: 'IssueFungibleToken'
      };

      const issueResult = await window.mintlayer.issueToken({ tokenData, authority });
      displayOutput(`Issue token result: ${JSON.stringify(issueResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function signTransaction() {
    const transactionData = document.getElementById('transactionData').value;

    if (!transactionData) {
      displayOutput('Please provide transaction data.');
      return;
    }

    try {
      const signResult = await window.mintlayer.signTransaction(JSON.parse(transactionData));
      displayOutput(`Sign transaction result: ${JSON.stringify(signResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  if (window.mintlayer) displayOutput('Mintlayer Connect SDK detected!');
  else displayOutput('Mintlayer Connect SDK not found.');
</script>
</body>
</html>
