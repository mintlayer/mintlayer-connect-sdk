<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mintlayer Wallet Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background: linear-gradient(to bottom right, #f0f9ff, #e0f2fe);
        min-height: 100vh;
      }
    </style>
</head>
<body class="font-sans text-gray-800 antialiased">
<div class="container mx-auto max-w-5xl p-6 flex flex-col lg:flex-row gap-6">
    <!-- Left Column: Actions -->
    <div class="lg:w-1/2 space-y-6">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Mintlayer Wallet Demo</h1>

        <div class="flex justify-center mb-4">
            <div class="flex items-center space-x-2">
                <label for="network" class="text-sm font-medium text-gray-700">Select Network:</label>
                <select id="network" onchange="changeNetwork()" class="border border-gray-300 rounded-md p-2 bg-white shadow-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="mainnet">Mainnet</option>
                    <option value="testnet">Testnet</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <button onclick="checkConnection()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Check Connection</button>
            <button onclick="connectWallet()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Connect Wallet</button>
            <button onclick="getNewAddress()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get New Address</button>
            <button onclick="getVersion()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Version</button>
            <button onclick="createDelegation()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Create Delegation</button>
            <button onclick="getBalance()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Balance</button>
            <button onclick="getDelegations()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Delegations</button>
            <button onclick="getDelegationsTotal()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Delegations Total</button>
            <button onclick="getAccountOrders()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Account Orders</button>
            <button onclick="getAvailableOrders()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Available Orders</button>
            <button onclick="getTokensOwned()" class="bg-blue-500 text-white py-2 px-4 rounded-md shadow hover:bg-blue-600 transition">Get Owned Tokens</button>
        </div>

        <div class="space-y-4">
            <!-- Toggle Buttons -->
            <div class="grid grid-cols-3 gap-4">
                <button onclick="toggleSection('transfer')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Transfer</button>
                <button onclick="toggleSection('signTx')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Sign Tx</button>
                <button onclick="toggleSection('issueToken')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Issue Token</button>
                <button onclick="toggleSection('mintToken')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Mint Token</button>
                <button onclick="toggleSection('createOrder')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Create Order</button>
                <button onclick="toggleSection('fillOrder')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Fill Order (DEX)</button>
                <button onclick="toggleSection('concludeOrder')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Conclude Order</button>
                <button onclick="toggleSection('broadcastTx')" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition">Broadcast</button>
            </div>

            <!-- Transfer Section -->
            <div id="transfer" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Transfer</h3>
                <div class="space-y-4">
                    <input type="text" id="send_to" placeholder="Recipient Address" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="amount" placeholder="Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="doTransfer()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Sign Transaction Section -->
            <div id="signTx" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Sign Transaction</h3>
                <div class="space-y-4">
                    <textarea id="transactionData" rows="5" placeholder="Complete Transaction Data" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"></textarea>
                    <button onclick="signTransaction()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Broadcast Transaction Section -->
            <div id="broadcastTx" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Broadcast Transaction</h3>
                <div class="space-y-4">
                    <textarea id="broadcast_tx" rows="5" placeholder="Transaction HEX Data" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none"></textarea>
                    <button onclick="broadcastTx()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Issue Token Section -->
            <div id="issueToken" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Issue Token</h3>
                <div class="space-y-4">
                    <input type="text" id="authority" placeholder="Authority Address" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="issueToken()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Mint Token Section -->
            <div id="mintToken" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Mint Token</h3>
                <div class="space-y-4">
                    <input type="text" id="mint_token_id" placeholder="Token ID" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="mint_destination" placeholder="Destination Address" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="mint_amount" placeholder="Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="mintToken()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Create Order Section -->
            <div id="createOrder" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Create Order</h3>
                <div class="space-y-4">
                    <input type="text" id="ask_token" placeholder="Ask Token" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="ask_amount" placeholder="Ask Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="give_token" placeholder="Give Token" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="give_amount" placeholder="Give Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="conclude_destination" placeholder="Conclude Destination" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="createOrder()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Fill Order Section -->
            <div id="fillOrder" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Fill Order (DEX)</h3>
                <div class="space-y-4">
                    <input type="text" id="fill_order_id" placeholder="Order ID" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="fill_amount" placeholder="Amount" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <input type="text" id="fill_destination" placeholder="Destination" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="fillOrder()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>

            <!-- Conclude Order Section -->
            <div id="concludeOrder" class="bg-white p-6 rounded-lg shadow-md hidden">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Conclude Order</h3>
                <div class="space-y-4">
                    <input type="text" id="conclude_order_id" placeholder="Order ID" class="w-full border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                    <button onclick="concludeOrder()" class="bg-green-500 text-white py-2 px-4 rounded-md shadow hover:bg-green-600 transition w-full">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Output -->
    <div class="lg:w-1/2">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Output</h3>
        <div id="output" class="bg-white p-4 rounded-lg shadow-md text-sm text-gray-600 whitespace-pre-wrap h-96 overflow-y-auto border border-gray-200"></div>
    </div>
</div>

<script src="../src/mintlayer-wasm-lib/release/wasm_wrappers.js"></script>
<script src="../src/mintlayer-connect-sdk.js"></script>
<script>
  function changeNetwork() {
    const network = document.getElementById('network').value;
    window.mintlayer.setNetwork(network);
    displayOutput(`Network changed to: ${network}`);
  }

  function toggleSection(sectionId) {
    const sections = ['transfer', 'signTx', 'issueToken', 'mintToken', 'createOrder', 'fillOrder', 'concludeOrder', 'broadcastTx'];
    sections.forEach(id => {
      const el = document.getElementById(id);
      if (id === sectionId) {
        el.classList.toggle('hidden');
      } else {
        el.classList.add('hidden');
      }
    });
  }

  function displayOutput(message) {
    const output = document.getElementById('output');
    output.textContent = `${new Date().toLocaleTimeString()} - ${message}\n${output.textContent}`;
  }

  async function checkConnection() {
    try {
      const result = await window.mintlayer.request({ method: 'checkConnection' });
      displayOutput(`Connection status: ${JSON.stringify(result, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function connectWallet() {
    try {
      const addresses = await window.mintlayer.connect();
      displayOutput(`Connected: ${JSON.stringify(addresses, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getNewAddress() {
    try {
      const addresses = await window.mintlayer.request({ method: 'getNewAddress' });
      displayOutput(`New address: ${JSON.stringify(addresses, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getVersion() {
    try {
      const version = await window.mintlayer.request({ method: 'version' });
      displayOutput(`Version: ${JSON.stringify(version, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getBalance() {
    try {
      const balance = await window.mintlayer.getBalance();
      displayOutput(`Balance: ${JSON.stringify(balance, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getDelegations() {
    try {
      const delegations = await window.mintlayer.getDelegations();
      displayOutput(`Delegations: ${JSON.stringify(delegations, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getDelegationsTotal() {
    try {
      const delegations = await window.mintlayer.getDelegationsTotal();
      displayOutput(`Delegations Total: ${JSON.stringify(delegations, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getAccountOrders() {
    try {
      const orders = await window.mintlayer.getAccountOrders();
      displayOutput(`Account Orders: ${JSON.stringify(orders, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getAvailableOrders() {
    try {
      const orders = await window.mintlayer.getAvailableOrders();
      displayOutput(`Available Orders: ${JSON.stringify(orders, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function getTokensOwned() {
    try {
      console.log('window.mintlayer', window.mintlayer);
      const tokens = await window.mintlayer.getTokensOwned();
      displayOutput(`Owned tokens: ${JSON.stringify(tokens, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function createDelegation() {
    try {
      const delegateResult = await window.mintlayer.request({
        method: 'delegate',
        params: { poolId: 'tpool106xgru3kyxzuhhsx666gvktd5y34ucke2wkkwqzysc29jk0ul82qzj4tzh' }
      });
      displayOutput(`Delegate: ${JSON.stringify(delegateResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function doTransfer() {
    const to = document.getElementById('send_to').value;
    const amount = document.getElementById('amount').value;

    if (!to || !amount) {
      displayOutput('Please provide both recipient address and amount.');
      return;
    }

    try {
      const transferResult = await window.mintlayer.transfer({ to, amount });
      displayOutput(`Transfer result: ${JSON.stringify(transferResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function issueToken() {
    const authority = document.getElementById('authority').value;

    if (!authority) {
      displayOutput('Please provide authority.');
      return;
    }

    try {
      const tokenData = {
        is_freezable: false,
        metadata_uri: {
          hex: "68747470733a2f2f6578616d706c652e636f6d2f646174612e6a736f6e",
          string: "https://example.com/data.json"
        },
        number_of_decimals: 8,
        token_ticker: { hex: "4c4c4c", string: "LLL" },
        total_supply: { type: "Unlimited" },
        type: 'IssueFungibleToken'
      };

      const issueResult = await window.mintlayer.issueToken({ tokenData, authority });
      displayOutput(`Issue token result: ${JSON.stringify(issueResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function mintToken() {
    const destination = document.getElementById('mint_destination').value;
    const amount = document.getElementById('mint_amount').value;
    const token_id = document.getElementById('mint_token_id').value;

    if (!destination || !amount) {
      displayOutput('Please provide both destination and amount.');
      return;
    }

    try {
      const mintResult = await window.mintlayer.mintToken({ destination, amount, token_id });
      displayOutput(`Mint token result: ${JSON.stringify(mintResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function createOrder() {
    const ask_token = document.getElementById('ask_token').value;
    const ask_amount = document.getElementById('ask_amount').value;
    const give_token = document.getElementById('give_token').value;
    const give_amount = document.getElementById('give_amount').value;
    const conclude_destination = document.getElementById('conclude_destination').value;

    if (!ask_token || !ask_amount || !give_token || !give_amount || !conclude_destination) {
      displayOutput('Please provide all order fields.');
      return;
    }

    try {
      const orderResult = await window.mintlayer.createOrder({
        ask_token,
        ask_amount,
        give_token,
        give_amount,
        conclude_destination
      });
      displayOutput(`Create order result: ${JSON.stringify(orderResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function fillOrder() {
    const order_id = document.getElementById('fill_order_id').value;
    const amount = document.getElementById('fill_amount').value;
    const destination = document.getElementById('fill_destination').value;

    if (!amount || !order_id || !destination) {
      displayOutput('Please provide token ID, amount, and order ID.');
      return;
    }

    try {
      const fillResult = await window.mintlayer.fillOrder({ amount, order_id, destination });
      displayOutput(`Fill order result: ${JSON.stringify(fillResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function concludeOrder() {
    const order_id = document.getElementById('conclude_order_id').value;

    if (!order_id) {
      displayOutput('Please provide order ID.');
      return;
    }

    try {
      const concludeResult = await window.mintlayer.concludeOrder({ order_id });
      displayOutput(`Conclude order result: ${JSON.stringify(concludeResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function signTransaction() {
    const transactionData = document.getElementById('transactionData').value;

    if (!transactionData) {
      displayOutput('Please provide transaction data.');
      return;
    }

    try {
      const signResult = await window.mintlayer.signTransaction(JSON.parse(transactionData));
      displayOutput(`Sign transaction result: ${JSON.stringify(signResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  async function broadcastTx() {
    const transactionData = document.getElementById('broadcast_tx').value;

    if (!transactionData) {
      displayOutput('Please provide transaction data.');
      return;
    }

    try {
      const broadcastResult = await window.mintlayer.broadcastTx(transactionData);
      displayOutput(`Broadcast transaction result: ${JSON.stringify(broadcastResult, null, 2)}`);
    } catch (error) {
      displayOutput(`Error: ${error.message}`);
    }
  }

  if (window.mintlayer) displayOutput('Mintlayer Connect SDK detected!');
  else displayOutput('Mintlayer Connect SDK not found.');
</script>
</body>
</html>
